GUIA PROMETHEUS - MONITOREO DE METRICAS
======================================

Â¿QUE ES PROMETHEUS?
===================
Prometheus es una herramienta que:
1. Recolecta mÃ©tricas de tu aplicaciÃ³n (requests, memoria, CPU, etc)
2. Las guarda en una base de datos de series temporales
3. Te permite hacer consultas para ver quÃ© pasÃ³ en tu app

En simple: Es un registro histÃ³rico de todo lo que pasÃ³ en tu aplicaciÃ³n.

========================================
COMO ACCEDER
========================================

URL: http://localhost:9090

Abre en el navegador y verÃ¡s una interfaz con:
- Un campo de bÃºsqueda para consultas
- GrÃ¡ficos de mÃ©tricas
- Historial de queries

========================================
METRICAS DISPONIBLES DE TU APP SPRING BOOT
========================================

Tu aplicaciÃ³n Spring Boot automÃ¡ticamente expone estas mÃ©tricas:

1. HTTP REQUESTS (lo mÃ¡s importante)
   - http_requests_total                â†’ Total de requests recibidas
   - http_request_duration_seconds      â†’ Tiempo que tarda cada request
   - http_requests_currently_active     â†’ Requests activos en este momento

2. MEMORIA (RAM que usa la app)
   - jvm_memory_used_bytes              â†’ Bytes de memoria usada
   - jvm_memory_max_bytes               â†’ MÃ¡ximo de memoria disponible
   - jvm_memory_committed_bytes         â†’ Memoria asignada

3. CPU (Procesador)
   - process_cpu_usage                  â†’ % de CPU que usa la app
   - process_system_cpu_usage           â†’ % de CPU del sistema total

4. DATABASE (Conexiones a Neon PostgreSQL)
   - hikaricp_connections               â†’ Conexiones activas a DB
   - hikaricp_connections_idle          â†’ Conexiones libres

5. RABBITMQ (Mensajes)
   Para esto necesitarÃ­as instrumentaciÃ³n especÃ­fica

========================================
COMO USAR PROMETHEUS - PASO A PASO
========================================

PASO 1: Abre http://localhost:9090

PASO 2: En el campo "Expression" escribe una mÃ©trica

PASO 3: Click en "Execute" o Enter

EJEMPLO 1: Ver TOTAL DE REQUESTS
=================================
En el campo Expression escribe:
  http_requests_total

Click Execute.

Ves algo como:
  http_requests_total{exception="None",method="POST",outcome="SUCCESS",status="201",uri="/api/usuarios",} 2
  http_requests_total{exception="None",method="GET",outcome="SUCCESS",status="200",uri="/api/cuentas",} 5

Significa:
- 2 requests POST a /api/usuarios con status 201 âœ…
- 5 requests GET a /api/cuentas con status 200 âœ…

EJEMPLO 2: Ver TIEMPO PROMEDIO DE REQUESTS
============================================
En el campo Expression escribe:
  rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])

Esto te muestra el tiempo PROMEDIO de requests en los Ãºltimos 5 minutos.

Resultado: 0.0125 = 12.5 milisegundos âœ… Muy rÃ¡pido

EJEMPLO 3: Ver REQUESTS POR ENDPOINT
=====================================
En el campo Expression escribe:
  http_requests_total{uri=~"/api/cuentas.*"}

Ves requests SOLO al endpoint /api/cuentas (y sus subrutas)

EJEMPLO 4: Ver REQUESTS FALLIDOS (errores)
===========================================
En el campo Expression escribe:
  http_requests_total{outcome="FAILURE"}

Ves SOLO los requests que tuvieron error (400, 403, 500, etc)

EJEMPLO 5: Ver USO DE MEMORIA
==============================
En el campo Expression escribe:
  jvm_memory_used_bytes / 1024 / 1024

Esto convierte bytes a MB.

Resultado: ~250 = Tu app usa 250 MB de RAM âœ…

EJEMPLO 6: Ver CONEXIONES A LA BASE DE DATOS
==============================================
En el campo Expression escribe:
  hikaricp_connections

Ves cuÃ¡ntas conexiones activas tienes a Neon PostgreSQL.

========================================
METRICAS IMPORTANTES PARA MONITORING
========================================

DIARIAMENTE CHEQUEA:
1. http_requests_total{outcome="FAILURE"} 
   â†’ Si sube mucho = hay errores en endpoints

2. http_request_duration_seconds (percentile)
   â†’ Si sube mucho = app lenta

3. jvm_memory_used_bytes
   â†’ Si sube constantemente sin bajar = memory leak

4. hikaricp_connections
   â†’ Si llega a mÃ¡ximo (20) = necesitas mÃ¡s conexiones a DB

========================================
CONSULTAS AVANZADAS (PromQL)
========================================

Â¿CUANTOS REQUESTS LLEGO EN LA ULTIMA HORA?
rate(http_requests_total[1h])

Â¿CUAL ENDPOINT ES MAS LENTO?
topk(5, rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m]))

Â¿CUANTOS ERRORES TUVIMOS HACE 10 MINUTOS?
increase(http_requests_total{outcome="FAILURE"}[10m])

========================================
TABS EN PROMETHEUS
========================================

1. GRAPH Tab (recomendado)
   - Muestra un grÃ¡fico visual
   - Ve cÃ³mo cambiÃ³ la mÃ©trica en el tiempo
   - Muy Ãºtil para detectar picos

2. TABLE Tab
   - Muestra valores en tabla
   - Ãštil para ver todos los valores

========================================
DATOS QUE TU APP GENERA PARA PROMETHEUS
========================================

Spring Boot automÃ¡ticamente envÃ­a datos a:
http://localhost:8080/actuator/prometheus

AhÃ­ estÃ¡n TODAS las mÃ©tricas en formato:
nombre_metrica{label1="valor1",label2="valor2"} 123

Ejemplo real:
http_requests_total{exception="None",method="POST",outcome="SUCCESS",status="201",uri="/api/cuentas"} 3

========================================
COMO CONECTAR PROMETHEUS A GRAFANA
========================================

Ya estÃ¡ hecho en docker-compose.yml

Prometheus recolecta mÃ©tricas
        â†“
Grafana las visualiza mÃ¡s bonito (http://localhost:3000)

========================================
RESUMEN
========================================

Prometheus = histÃ³rico de mÃ©tricas de tu app
Usa para:
âœ… Ver cuÃ¡ntos requests/segundo reciben tus endpoints
âœ… Detectar errores (4xx, 5xx)
âœ… Ver si la app estÃ¡ lenta
âœ… Detectar memory leaks
âœ… Monitorear conexiones a BD

URLs importantes:
- http://localhost:8080/actuator/prometheus â†’ MÃ©tricas en crudo
- http://localhost:9090 â†’ UI de Prometheus (consultas)
- http://localhost:3000 â†’ Grafana (dashboards bonitos)

========================================
TUS ENDPOINTS EN PROMETHEUS
========================================

A medida que haces requests, Prometheus recolecta:

POST /api/auth/register
  â†’ http_requests_total{uri="/api/auth/register",method="POST",...}

POST /api/auth/login
  â†’ http_requests_total{uri="/api/auth/login",method="POST",...}

POST /api/cuentas
  â†’ http_requests_total{uri="/api/cuentas",method="POST",...}

GET /api/cuentas
  â†’ http_requests_total{uri="/api/cuentas",method="GET",...}

POST /api/transacciones
  â†’ http_requests_total{uri="/api/transacciones",method="POST",...}

GET /actuator/health
  â†’ http_requests_total{uri="/actuator/health",...}

========================================
INTENTA ESTO AHORA
========================================

1. Abre http://localhost:9090
2. En "Expression" escribe: http_requests_total
3. Click "Execute"
4. VerÃ¡s todas las mÃ©tricas de requests que tÃº hiciste

Si ves algo, Â¡Prometheus funciona! ðŸŽ‰

========================================
